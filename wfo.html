<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalender WFO Mingguan</title>
  <style>
    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f7f7f7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 20px;
    }

    .calendar-container {
      background-color: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 1100px;
    }

    /* Calendar Header */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .calendar-header h2 {
      font-size: 28px;
      color: #333;
    }

    .calendar-header button {
      padding: 12px 20px;
      font-size: 16px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .calendar-header button:hover {
      background-color: #0056b3;
    }

    /* Calendar Layout */
    .calendar {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }

    /* Names Column */
    .names-column,
    .days-column {
      background-color: #fff;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #ddd;
    }

    .names-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .names-column .name {
      background-color: #ffcc00;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: background-color 0.3s ease;
    }

    .names-column .name:hover {
      background-color: #ff9800;
    }

    .days-column {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .days-column .day {
      background-color: #fff;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
      text-align: center;
      min-height: 100px;
      border: 1px dashed #ddd;
      position: relative;
      transition: background-color 0.3s ease;
    }

    .days-column .day:hover {
      background-color: #f0f0f0;
    }

    .days-column .day .employee {
      background-color: #007BFF;
      color: white;
      padding: 8px;
      border-radius: 5px;
      margin: 5px 0;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s ease;
    }

    .days-column .day .employee:hover {
      background-color: #0056b3;
    }

    .days-column .day .remove {
      color: red;
      font-size: 18px;
      cursor: pointer;
      margin-left: 10px;
    }

    .download-btn {
      margin-top: 20px;
      padding: 12px 30px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      transition: background-color 0.3s ease;
    }

    .download-btn:hover {
      background-color: #218838;
    }

    /* Responsive Styles */
    @media screen and (max-width: 768px) {
      .calendar {
        grid-template-columns: 1fr;
      }

      .names-column,
      .days-column {
        margin-bottom: 20px;
      }

      .calendar-header h2 {
        font-size: 24px;
      }

      .calendar-header button {
        padding: 10px 18px;
        font-size: 14px;
      }
    }

    @media screen and (max-width: 480px) {
      .calendar-container {
        padding: 15px;
      }

      .calendar-header h2 {
        font-size: 20px;
      }

      .calendar-header button {
        font-size: 12px;
      }
      
      .download-btn {
        padding: 10px;
      }
    }

  </style>
</head>
<body>

  <div class="calendar-container">
    <div class="calendar-header">
      <h2>Kalender WFO Mingguan</h2>
      <button onclick="downloadLog()">Download Log Mingguan</button>
    </div>

    <div class="calendar">
      <div class="names-column" id="names-column">
        <!-- Nama karyawan akan muncul di sini -->
      </div>
      
      <div class="days-column" id="days-column">
        <!-- Hari kerja akan muncul di sini -->
      </div>
    </div>

    <div>
      <button class="download-btn" onclick="downloadLog()">Download Log Mingguan</button>
    </div>
  </div>

  <script>
    const employees = ["Alice", "Bob", "Charlie", "David", "Eva"];
    const weekdays = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat"];
    const today = new Date();
    const dayOfWeek = today.getDay();
    const startOfWeek = new Date(today.setDate(today.getDate() - dayOfWeek + 1)); // Senin minggu ini

    let schedule = JSON.parse(localStorage.getItem("schedule")) || {};

    // Membuat kolom nama karyawan
    function createNamesColumn() {
      const namesColumn = document.getElementById("names-column");
      employees.forEach((employee) => {
        const nameDiv = document.createElement("div");
        nameDiv.classList.add("name");
        nameDiv.draggable = true;
        nameDiv.textContent = employee;
        nameDiv.dataset.employee = employee;

        // Event listener untuk drag
        nameDiv.addEventListener("dragstart", (e) => dragStart(e));
        nameDiv.addEventListener("dragend", (e) => dragEnd(e));
        
        // Event listener untuk touch (mobile)
        nameDiv.addEventListener("touchstart", (e) => touchStart(e));
        nameDiv.addEventListener("touchend", (e) => touchEnd(e));
        
        namesColumn.appendChild(nameDiv);
      });
    }

    // Membuat kolom hari kerja dengan tanggal
    function createDaysColumn() {
      const daysColumn = document.getElementById("days-column");
      weekdays.forEach((day, index) => {
        const dayDiv = document.createElement("div");
        dayDiv.classList.add("day");
        dayDiv.dataset.day = day;

        // Menentukan tanggal untuk setiap hari kerja
        const currentDay = new Date(startOfWeek);
        currentDay.setDate(startOfWeek.getDate() + index);
        const formattedDate = currentDay.toLocaleDateString('id-ID', { day: 'numeric', month: 'long' });

        const dayLabel = document.createElement("div");
        dayLabel.textContent = `${day}, ${formattedDate}`;
        dayDiv.appendChild(dayLabel);

        // Event listener untuk drag over dan drop
        dayDiv.addEventListener("dragover", (e) => dragOver(e));
        dayDiv.addEventListener("drop", (e) => drop(e));
        
        // Event listener untuk touch (mobile)
        dayDiv.addEventListener("touchmove", (e) => touchMove(e));
        dayDiv.addEventListener("touchend", (e) => drop(e));

        // Menampilkan jadwal yang sudah ada di localStorage
        if (schedule[day]) {
          schedule[day].forEach(employee => {
            addEmployeeToDay(dayDiv, employee);
          });
        }

        daysColumn.appendChild(dayDiv);
      });
    }

    // Fungsi untuk menambahkan nama karyawan ke dalam hari
    function addEmployeeToDay(dayDiv, employee) {
      const employeeDiv = document.createElement("div");
      employeeDiv.classList.add("employee");
      employeeDiv.textContent = `${employee} `;
      const removeBtn = document.createElement("span");
      removeBtn.textContent = "X";
      removeBtn.classList.add("remove");
      removeBtn.addEventListener("click", () => removeEmployeeFromDay(dayDiv, employee, removeBtn));
      employeeDiv.appendChild(removeBtn);
      dayDiv.appendChild(employeeDiv);
    }

    // Fungsi saat mulai drag
    function dragStart(event) {
      event.target.classList.add("dragging");
    }

    // Fungsi saat selesai drag
    function dragEnd(event) {
      event.target.classList.remove("dragging");
    }

    // Fungsi saat mulai touch
    function touchStart(event) {
      event.target.classList.add("dragging");
    }

    // Fungsi saat selesai touch
    function touchEnd(event) {
      event.target.classList.remove("dragging");
    }

    // Fungsi drag over
    function dragOver(event) {
      event.preventDefault();
    }

    // Fungsi drop
    function drop(event) {
      event.preventDefault();
      const employee = document.querySelector(".name.dragging");
      if (employee) {
        const day = event.target.closest(".day");
        if (day) {
          const dayName = day.dataset.day;
          const employeeName = employee.dataset.employee;

          if (!schedule[dayName]) {
            schedule[dayName] = [];
          }

          if (!schedule[dayName].includes(employeeName)) {
            schedule[dayName].push(employeeName);
            updateDaySchedule(day, schedule[dayName]);
            saveSchedule();
          }
        }
      }
    }

    // Update tampilan jadwal di setiap hari
    function updateDaySchedule(dayElement, daySchedule) {
      dayElement.innerHTML = `<div>${dayElement.dataset.day}</div>`;
      daySchedule.forEach(employee => {
        addEmployeeToDay(dayElement, employee);
      });
    }

    // Fungsi untuk menghapus nama karyawan dari jadwal
    function removeEmployeeFromDay(dayDiv, employeeName, removeBtn) {
      const dayName = dayDiv.dataset.day;
      schedule[dayName] = schedule[dayName].filter(employee => employee !== employeeName);
      removeBtn.parentElement.remove(); // Menghapus elemen nama karyawan beserta tombol X
      updateDaySchedule(dayDiv, schedule[dayName]);
      saveSchedule();
    }

    // Menyimpan schedule ke localStorage
    function saveSchedule() {
      localStorage.setItem("schedule", JSON.stringify(schedule));
    }

    // Fungsi untuk mendownload log mingguan
    function downloadLog() {
      let log = "Log Jadwal WFO Mingguan\n\n";
      for (let day in schedule) {
        log += `${day}: ${schedule[day].join(", ")}\n`;
      }

      const blob = new Blob([log], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "log_wfo_mingguan.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    // Memulai halaman
    createNamesColumn();
    createDaysColumn();
  </script>

</body>
</html>
